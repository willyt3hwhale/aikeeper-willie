#!/bin/bash
# willie - wrapper script that handles venv setup automatically

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
VENV_DIR="$SCRIPT_DIR/.venv"
REQUIREMENTS="prompt_toolkit"

# Create venv if it doesn't exist
if [ ! -d "$VENV_DIR" ]; then
    echo "Setting up virtual environment..."
    python3 -m venv "$VENV_DIR"
    "$VENV_DIR/bin/pip" install --quiet --upgrade pip
    "$VENV_DIR/bin/pip" install --quiet $REQUIREMENTS
    echo "Setup complete."
fi

# Check if dependencies need to be installed
if ! "$VENV_DIR/bin/python" -c "import prompt_toolkit" 2>/dev/null; then
    "$VENV_DIR/bin/pip" install --quiet $REQUIREMENTS
fi

# Run willie.py with all arguments passed through
exec "$VENV_DIR/bin/python" "$SCRIPT_DIR/willie.py" "$@"
